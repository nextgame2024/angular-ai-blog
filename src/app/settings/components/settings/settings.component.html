<ng-container *ngIf="data$ | async as data">
  <div *ngIf="currentUser" class="container mx-auto px-4 py-6">
    <div class="max-w-2xl mx-auto">
      <p-card header="Settings" class="shadow-sm">
        <div class="flex items-center gap-4 mb-4">
          <p-avatar
            [image]="form.value.image || defaultAvatar"
            shape="circle"
            size="xlarge"
          >
          </p-avatar>
          <div class="text-sm text-gray-500">Profile picture preview</div>
        </div>

        <mc-backend-error-messages
          *ngIf="data.backendErrors"
          [backendErrors]="data.backendErrors"
        >
        </mc-backend-error-messages>

        <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-4 mt-2">
          <!-- Image URL -->
          <div class="p-inputgroup">
            <span class="p-inputgroup-addon"><i class="pi pi-image"></i></span>
            <input
              pInputText
              type="url"
              formControlName="image"
              placeholder="URL of profile picture"
              class="w-full"
            />
          </div>

          <!-- Username -->
          <div class="p-inputgroup">
            <span class="p-inputgroup-addon"><i class="pi pi-user"></i></span>
            <input
              pInputText
              type="text"
              formControlName="username"
              placeholder="Username"
              class="w-full"
            />
          </div>

          <!-- Bio -->
          <textarea
            pInputTextarea
            formControlName="bio"
            rows="4"
            placeholder="Short bio about you"
            class="w-full"
          >
          </textarea>

          <!-- Email -->
          <div class="p-inputgroup">
            <span class="p-inputgroup-addon"
              ><i class="pi pi-envelope"></i
            ></span>
            <input
              pInputText
              type="email"
              formControlName="email"
              placeholder="Email"
              class="w-full"
            />
          </div>

          <!-- New Password (FIX: correct control name) -->
          <p-password
            formControlName="password"
            [feedback]="false"
            [toggleMask]="true"
            inputStyleClass="p-inputtext w-full"
            [inputStyle]="{ width: '100%' }"
            placeholder="New password"
          >
          </p-password>

          <button
            pButton
            type="submit"
            label="Update settings"
            class="w-full md:w-auto"
            [disabled]="form.invalid || data.isSubmitting"
          ></button>
        </form>
      </p-card>

      <div class="mt-6">
        <button
          pButton
          label="Log out"
          class="p-button-outlined p-button-danger"
          (click)="logout()"
        ></button>
      </div>
    </div>
  </div>
</ng-container>
