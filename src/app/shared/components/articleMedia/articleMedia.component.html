<!-- Mobile-first: media on top (full width). On md+, this sits in the left column of the card grid -->
<div class="relative w-full">
  <!-- Prefer video, else image, else audio, else placeholder -->
  <ng-container *ngIf="video as v; else nonVideo">
    <div class="relative overflow-hidden rounded md:rounded-md">
      <video
        #videoEl
        class="block w-full h-52 md:h-56 min-h-[20rem] md:min-h-[25rem] object-cover bg-black"
        [attr.src]="v.url"
        [muted]="isMuted"
        playsinline
        preload="metadata"
        controlslist="nodownload"
      ></video>

      <!-- Overlay controls -->
      <div
        class="absolute top-16 right-2 flex items-center gap-2 bg-black/50 backdrop-blur-sm text-white rounded-full px-2 py-1"
      >
        <button
          class="px-2 py-1 rounded-full hover:bg-white/10"
          (click)="play()"
          [disabled]="isPlaying"
          aria-label="Play"
          title="Play"
        >
          <i class="pi pi-play"></i>
        </button>
        <button
          class="px-2 py-1 rounded-full hover:bg-white/10"
          (click)="pause()"
          [disabled]="!isPlaying"
          aria-label="Pause"
          title="Pause"
        >
          <i class="pi pi-pause"></i>
        </button>
        <button
          class="px-2 py-1 rounded-full hover:bg-white/10"
          (click)="stop()"
          aria-label="Stop"
          title="Stop"
        >
          <i class="pi pi-stop"></i>
        </button>
        <button
          class="px-2 py-1 rounded-full hover:bg-white/10"
          (click)="toggleMute()"
          [attr.aria-label]="isMuted ? 'Unmute' : 'Mute'"
          [title]="isMuted ? 'Unmute' : 'Mute'"
        >
          <i
            class="pi"
            [ngClass]="isMuted ? 'pi-volume-off' : 'pi-volume-up'"
          ></i>
        </button>
      </div>
    </div>
  </ng-container>

  <ng-template #nonVideo>
    <ng-container *ngIf="image as img; else maybeAudio">
      <img
        class="block w-full h-52 md:h-56 min-h-[20rem] md:min-h-[25rem] object-cover rounded md:rounded-md"
        [src]="img.url || defaultPoster"
        alt="article cover"
        (error)="onImageError($event)"
      />
    </ng-container>

    <ng-template #maybeAudio>
      <ng-container *ngIf="audio as a; else placeholder">
        <div class="p-3 border rounded md:rounded-md dark:border-neutral-700">
          <p class="text-sm mb-2">Audio</p>
          <audio
            class="w-full"
            [src]="a.url"
            controls
            preload="metadata"
          ></audio>
        </div>
      </ng-container>

      <ng-template #placeholder>
        <div
          class="w-full h-52 md:h-56 min-h-[20rem] md:min-h-[25rem] rounded md:rounded-md bg-gradient-to-br from-neutral-200 to-neutral-300 dark:from-neutral-800 dark:to-neutral-700 grid place-items-center"
        >
          <i class="pi pi-image text-3xl opacity-60"></i>
        </div>
      </ng-template>
    </ng-template>
  </ng-template>
</div>
