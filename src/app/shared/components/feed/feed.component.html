<ng-container *ngIf="data$ | async as data">
  <mc-loading *ngIf="data.isLoading"></mc-loading>
  <mc-error-message
    *ngIf="data.error"
    [message]="data.error"
  ></mc-error-message>

  <div *ngIf="data.feed">
    <div class="space-y-4">
      <p-card *ngFor="let article of data.feed.articles" class="shadow-sm">
        <!-- header: avatar, author, date, favorite -->
        <div class="flex items-center gap-3">
          <a
            [routerLink]="['/profiles', article.author.username]"
            class="shrink-0"
          >
            <img
              class="w-10 h-10 rounded-full object-cover"
              [src]="article.author.image || defaultAvatar"
              [alt]="article.author.username + ' avatar'"
              (error)="setFallback($event)"
            />
          </a>

          <div class="min-w-0">
            <a
              [routerLink]="['/profiles', article.author.username]"
              class="block font-medium truncate"
            >
              {{ article.author.username }}
            </a>
            <span class="text-sm text-gray-500">
              {{ article.createdAt | date : "mediumDate" }}
            </span>
          </div>

          <div class="ml-auto">
            <mc-add-to-favorites
              [isFavorited]="article.favorited"
              [articleSlug]="article.slug"
              [favoritesCount]="article.favoritesCount"
            >
            </mc-add-to-favorites>
          </div>
        </div>

        <!-- content -->
        <a [routerLink]="['/articles', article.slug]" class="block mt-3">
          <h2 class="text-lg md:text-xl font-semibold leading-snug">
            {{ article.title }}
          </h2>
          <p class="text-gray-600 mt-1 line-clamp-3">
            {{ article.description }}
          </p>
        </a>

        <!-- footer: tags + read more -->
        <div class="mt-3 flex flex-wrap items-center justify-between gap-3">
          <mc-tag-list [tags]="article.tagList"></mc-tag-list>

          <a
            [routerLink]="['/articles', article.slug]"
            pButton
            label="Read more"
            class="p-button-text p-button-sm"
          >
          </a>
        </div>
      </p-card>
    </div>

    <!-- pagination -->
    <div class="mt-6">
      <mc-pagination
        [total]="data.feed.articlesCount"
        [limit]="limit"
        [url]="baseUrl"
        [currentPage]="currentPage"
      >
      </mc-pagination>
    </div>
  </div>
</ng-container>
